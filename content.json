{"meta":{"title":"Tindy Blog","subtitle":"分享自己的学习点滴","description":null,"author":"Tian Tao","url":"http://www.tiantao.win"},"pages":[{"title":"","date":"2016-08-16T13:36:14.579Z","updated":"2016-08-16T13:36:14.579Z","comments":true,"path":"404.html","permalink":"http://www.tiantao.win/404.html","excerpt":"","text":"页面未找到 body{ margin:0 auto; }"},{"title":"标签","date":"2016-08-09T12:19:05.290Z","updated":"2016-07-23T07:11:15.622Z","comments":true,"path":"tags/index.html","permalink":"http://www.tiantao.win/tags/index.html","excerpt":"","text":""},{"title":"","date":"2016-08-17T15:23:43.831Z","updated":"2016-08-17T14:05:53.356Z","comments":true,"path":"static/clipboarddata.html","permalink":"http://www.tiantao.win/static/clipboarddata.html","excerpt":"","text":"QQ截图网页粘贴 点击我粘贴图片 var divImage = document.getElementById('imgEdit'); divImage.addEventListener('paste', function (event) { // 添加到事件对象中的访问系统剪贴板的接口 var clipboardData = event.clipboardData, i = 0, items, item, types; if( clipboardData ){ console.log('your browser support clipboardData'); items = clipboardData.items; if( !items ){ return; } item = items[0]; // 保存在剪贴板中的数据类型 types = clipboardData.types || []; for( ; i < types.length; i++ ){ if(types[i] === 'Files'){ item = items[i]; break; } } // 判断是否为图片数据 if( item && item.kind === 'file' && item.type.match(/^image\\//i) ){ // 读取该图片 imgReader( item ); } } }); var imgReader = function (item) { var file = item.getAsFile(), //使用local IO来读取文件显示 reader = new FileReader(); reader.onload = function (e) { document.getElementById('myImageDataLoadDemo').setAttribute('src', e.target.result); }; // 读取文件 reader.readAsDataURL(file); }; ///使用Html5 的FormData上传到服务器来显示 //function zE(a, b) { //var c = new FormData; //c.append(\"via\", \"xhr2\"); //c.append(\"upload_file\", b); //var d; //d = $.ajaxSettings.xhr(); //d.withCredentials = i; //var f = $.ajax({url: a.Vz,data: c,processData: l,contentType: l,xhr: function() { // return d // },type: \"POST\"}).done(function(a) {"},{"title":"分类","date":"2016-08-16T13:00:01.979Z","updated":"2016-07-23T07:11:10.616Z","comments":true,"path":"categories/index.html","permalink":"http://www.tiantao.win/categories/index.html","excerpt":"","text":""},{"title":"关于","date":"2016-07-22T11:21:58.000Z","updated":"2016-08-16T13:05:31.419Z","comments":true,"path":"about/index.html","permalink":"http://www.tiantao.win/about/index.html","excerpt":"","text":"123456&#123; priorities: ['Christian', 'Family', 'Work'], work: ['@LeanKit', '@PluralSight'], tech: ['JavaScript', 'React', 'jQuery', 'HTML5'], titles: ['MS MVP', '#IEuserAgents']&#125;;"}],"posts":[{"title":"利用 ClipboardData 在网页上粘贴 QQ 截图","slug":"clipboarddata","date":"2016-08-17T12:49:17.000Z","updated":"2016-08-17T15:10:53.308Z","comments":true,"path":"2016/08/17/clipboarddata/","link":"","permalink":"http://www.tiantao.win/2016/08/17/clipboarddata/","excerpt":"","text":"最近到知乎评论框可以直接粘贴来自 QQ 或者其他截图工具的图片，比较好奇。以前一直用的 Ueditor 也有这个功能并且还带截图工具，没怎么关注其实现方式。今天扒下代码，学习下记录下。 关键的 ClipboardData 对象DOM元素的 cut、copy 和 paste 事件的 clipboardData 属性保存了一个 DataTransfer 对象，这个对象可用于： 描述哪些数据可以由 cut 和 copy 事件处理器放入剪切板，通常通过调用 setData(format, data) 方法； 获取由 paste 事件处理器拷贝进剪切板的数据，通常通过调用 getData(format) 方法 实现方式这里获取剪贴板的图片肯定是通过 paste 事件。可以通过 clipboardData 的类型 types 来判断剪贴板里面的内容是文件还是文字，然后再在 clipboardData.items 中取出来。这里取出来的是二进制文件，我们可以通过 Local IO 的 FileReader 来读取。也可以像知乎那样使用 H5 中 FormData 存储，再 post 到服务端换回一个 Image 标签。 注意： 以上的 FileReader 和 FormData 都只有现代浏览器才支持。 Firefox 和 IE 11 不允许直接粘贴图片的，需要在 DOM 元素上设置 contenteditable=”true”。 chrome 的是 g_editable=”true”。 Talk is cheap. Show me the code.div 用来粘贴图片，img 用来显示。12&lt;div id='divEdit' g_editable=\"true\" contenteditable=\"true\"&gt;点击我粘贴图片&lt;/div&gt;&lt;img src=\"\" id=\"myImageLoadDemo\" /&gt;&lt;/div&gt; 监听 div 的 paste 事件，获取剪贴板内容，判断类型，读取图片。 123456789101112131415161718192021222324252627282930313233343536373839var divEdit = document.getElementById('divEdit');divEdit.addEventListener('paste', function (event) &#123; // 添加到事件对象中的访问系统剪贴板的接口 var clipboardData = event.clipboardData, i = 0, items, item, types; if (clipboardData) &#123; console.log('your browser support clipboardData'); items = clipboardData.items; if (!items) &#123; return; &#125; item = items[0]; // 保存在剪贴板中的数据类型 types = clipboardData.types || []; for (; i &lt; types.length; i++) &#123; if (types[i] === 'Files') &#123; item = items[i]; break; &#125; &#125; // 判断是否为图片数据 if (item &amp;&amp; item.kind === 'file' &amp;&amp; item.type.indexOf(\"image\")) &#123; // 读取图片 imgReader(item); &#125; &#125;&#125;);var imgReader = function (item) &#123; var file = item.getAsFile(), //使用 local IO 来读取文件显示 //或者 post 到服务端生成 image 标签 reader = new FileReader(); reader.onload = function (e) &#123; document.getElementById('myImageLoadDemo').setAttribute('src', e.target.result); &#125;; // 读取文件 reader.readAsDataURL(file);&#125;; 例子 https://www.zhihu.com/question/20893119参考 https://www.zhihu.com/question/20893119本文由 Tian Tao 创作，采用 知识共享署名 3.0 中国大陆许可协议 进行许可。可自由转载、引用，但需署名作者且注明文章出处。","categories":[{"name":"前端","slug":"前端","permalink":"http://www.tiantao.win/categories/前端/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"http://www.tiantao.win/tags/javascript/"}],"keywords":[{"name":"前端","slug":"前端","permalink":"http://www.tiantao.win/categories/前端/"}]},{"title":"Hello World","slug":"hello-world","date":"2016-08-09T12:19:05.290Z","updated":"2016-08-17T12:54:51.885Z","comments":true,"path":"2016/08/09/hello-world/","link":"","permalink":"http://www.tiantao.win/2016/08/09/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[{"name":"前端","slug":"前端","permalink":"http://www.tiantao.win/categories/前端/"}],"tags":[{"name":"test","slug":"test","permalink":"http://www.tiantao.win/tags/test/"}],"keywords":[{"name":"前端","slug":"前端","permalink":"http://www.tiantao.win/categories/前端/"}]}]}